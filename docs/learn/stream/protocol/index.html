<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-learn/stream/protocol">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">协议描述 | 钉钉开发者百科</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://open-dingtalk.github.io/developerpedia/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://open-dingtalk.github.io/developerpedia/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://open-dingtalk.github.io/developerpedia/docs/learn/stream/protocol"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="协议描述 | 钉钉开发者百科"><meta data-rh="true" name="description" content="钉钉 Stream 协议在官方文档库中有详细说明。"><meta data-rh="true" property="og:description" content="钉钉 Stream 协议在官方文档库中有详细说明。"><link data-rh="true" rel="icon" href="/developerpedia/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://open-dingtalk.github.io/developerpedia/docs/learn/stream/protocol"><link data-rh="true" rel="alternate" href="https://open-dingtalk.github.io/developerpedia/docs/learn/stream/protocol" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-dingtalk.github.io/developerpedia/docs/learn/stream/protocol" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/developerpedia/blog/rss.xml" title="钉钉开发者百科 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/developerpedia/blog/atom.xml" title="钉钉开发者百科 Atom Feed"><link rel="stylesheet" href="/developerpedia/assets/css/styles.4beab234.css">
<link rel="preload" href="/developerpedia/assets/js/runtime~main.efb555ec.js" as="script">
<link rel="preload" href="/developerpedia/assets/js/main.9f82b880.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/developerpedia/"><div class="navbar__logo"><img src="/developerpedia/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/developerpedia/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">钉钉开发者百科</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/developerpedia/docs/intro">开发者文档</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/open-dingtalk/developerpedia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/developerpedia/docs/intro">概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/developerpedia/docs/category/探索">探索</a><button aria-label="Toggle the collapsible sidebar category &#x27;探索&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/developerpedia/docs/category/学习">学习</a><button aria-label="Toggle the collapsible sidebar category &#x27;学习&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/developerpedia/docs/category/机器人">机器人</a><button aria-label="Toggle the collapsible sidebar category &#x27;机器人&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/developerpedia/docs/category/stream-mode-1">Stream Mode</a><button aria-label="Toggle the collapsible sidebar category &#x27;Stream Mode&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developerpedia/docs/learn/stream/overview">概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/developerpedia/docs/learn/stream/protocol">协议描述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/developerpedia/docs/learn/stream/faq">常见问题</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/developerpedia/docs/category/互动卡片">互动卡片</a><button aria-label="Toggle the collapsible sidebar category &#x27;互动卡片&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/developerpedia/docs/category/权限中心">权限中心</a><button aria-label="Toggle the collapsible sidebar category &#x27;权限中心&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/developerpedia/docs/category/错误码">错误码</a><button aria-label="Toggle the collapsible sidebar category &#x27;错误码&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/developerpedia/docs/category/开发">开发</a><button aria-label="Toggle the collapsible sidebar category &#x27;开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/developerpedia/docs/category/社区贡献">社区贡献</a><button aria-label="Toggle the collapsible sidebar category &#x27;社区贡献&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/developerpedia/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/developerpedia/docs/category/学习"><span itemprop="name">学习</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/developerpedia/docs/category/stream-mode-1"><span itemprop="name">Stream Mode</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">协议描述</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>协议描述</h1><p>钉钉 Stream 协议在官方文档库中有<a href="https://open.dingtalk.com/document/direction/stream-mode-protocol-access-description" target="_blank" rel="noopener noreferrer">详细说明</a>。
本文档予以补充和更新，对于本文中关键内容将会在完成内部审核之后，持续更新到官方文档中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="与-sdk-的关系">与 SDK 的关系<a href="#与-sdk-的关系" class="hash-link" aria-label="Direct link to 与 SDK 的关系" title="Direct link to 与 SDK 的关系">​</a></h2><p>推荐采用<a href="/developerpedia/docs/develop/sdk/overview">官方 SDK</a>接入钉钉 Stream 模式。但是对于缺乏 SDK 支持的场景，本文提供协议描述，帮助开发者使用非 SDK 方式接入 Stream 模式，或者直接参与 SDK 开发。</p><p>同时鼓励以下两种形式的社区贡献：</p><ol><li>提供非官方支持的语言，例如 .NET、PHP等</li><li>优化官方 SDK 不完善的地方，提交 PR 或者建立新的开源项目</li></ol><p>通过以下两种方式提供对于社区贡献的支持：</p><ol><li>在官方文档库中予以推荐</li><li>建立<a href="/developerpedia/docs/explore/support?via=moon-group">钉钉沟通群</a>，帮助社区解决 SDK 开发中遇到的技术问题</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="协议接入步骤">协议接入步骤<a href="#协议接入步骤" class="hash-link" aria-label="Direct link to 协议接入步骤" title="Direct link to 协议接入步骤">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="介绍">介绍<a href="#介绍" class="hash-link" aria-label="Direct link to 介绍" title="Direct link to 介绍">​</a></h3><p>钉钉 Stream 协议接入主要包括两个步骤：</p><ol><li>注册连接凭证：通过 HTTP POST 方法，获取 WebSocket 通道的 endpoint（协议域名和Path信息） 和 ticket（URL 中的 Ticket 参数）；</li><li>建立 WebSocket 连接：通过步骤一中获取的 endpoint 和 ticket 信息，建立 WebSocket 通道，开始订阅；</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤一注册连接凭证">步骤一：注册连接凭证<a href="#步骤一注册连接凭证" class="hash-link" aria-label="Direct link to 步骤一：注册连接凭证" title="Direct link to 步骤一：注册连接凭证">​</a></h3><p>调用以下接口注册 Stream 连接凭证：</p><p>请求方法(HTTP)示例：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">POST /v1.0/gateway/connections/open HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: api.dingtalk.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type:application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;clientId&quot;: &quot;${ClientID}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;clientSecret&quot;: &quot;${ClientSecret}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;localIp&quot;: &quot;10.34.22.11&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subscriptions&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;topic&quot;: &quot;*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;EVENT&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;topic&quot;: &quot;/v1.0/im/bot/messages/get&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;type&quot;: &quot;CALLBACK&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ua&quot;: &quot;dingtalk-sdk-java/1.0.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Body参数</p><table><thead><tr><th>名称</th><th>类型</th><th>是否必填</th><th>描述</th></tr></thead><tbody><tr><td>clientId</td><td>String</td><td>是</td><td>钉钉应用的 OAuth ClientID<br>三方应用: 旧称 SuiteKey<br>企业自建：旧称 Appkey</td></tr><tr><td>clientSecret</td><td>String</td><td>是</td><td>钉钉应用的 OAuth ClientSecret<br>三方应用：旧称SuiteSecret<br>企业自建：旧称AppSecret</td></tr><tr><td>subscriptions</td><td>Array</td><td>是</td><td>订阅信息，平台将根据此信息判断是否通过stream方式推送给当前客户端</td></tr><tr><td>- type</td><td>String</td><td>是</td><td>订阅事件类型</td></tr><tr><td>- topic</td><td>String</td><td>是</td><td>订阅的具体业务 Topic，Topic列表及详细解释可以参考本文中下一章节“<a href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B">消息类型</a>”中介绍部分</td></tr><tr><td>ua</td><td>String</td><td>否</td><td>标记客户端类型，格式为name-sdk-lang/version，例如java版本的sdk可命名为dingtalk-sdk-java/1.0.0</td></tr><tr><td>localIp</td><td>String</td><td>否</td><td>运行SDK服务的当前本地IP，方便定位排查连接问题。多个IP采用英文逗号（,）分隔</td></tr></tbody></table><p>返回参数，用于建立 WebSocket 所需要的域名、Path、凭证信息，具体用法详见步骤二中的描述：</p><table><thead><tr><th>名称</th><th>类型</th><th>描述信息</th></tr></thead><tbody><tr><td>endpoint</td><td>String</td><td>钉钉服务端的地址信息，用于建立WebSocket连接的域名和Path</td></tr><tr><td>ticket</td><td>String</td><td>服务端颁发的身份信息，客户端需凭此信息和钉钉服务端建连连接。<br>重要：<br>ticket的有效期为90秒且只能用来建立一条连接，请勿存储ticket或重复使用。</td></tr></tbody></table><p>响应示例：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: application/json;charset=utf-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;endpoint&quot;: &quot;wss://wss-open-connection.dingtalk.com:443/connect&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ticket&quot;: &quot;7724109a-ea43-4aa2-b803-87d82c5aaee6&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="步骤二建立-websocket-连接">步骤二：建立 WebSocket 连接<a href="#步骤二建立-websocket-连接" class="hash-link" aria-label="Direct link to 步骤二：建立 WebSocket 连接" title="Direct link to 步骤二：建立 WebSocket 连接">​</a></h3><p>注册长连接信息成功后，客户端将获取长连的身份标识ticket和钉钉开放平台的地址信息，通过此信息客户端和钉钉服务端建立一条WebSocket连接，握手请求的路径和参数信息如下所示</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GET /connect?ticket=${ticket} HTTP/1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host: wss-open-connection.dingtalk.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Upgrade: websocket</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意事项</div><div class="admonitionContent_S0QG"><p>以上示例中 Host、Path 信息仅用于示例展示，请用步骤一中返回的 endpoint 信息作为 Host 和 Path 构建 WebSocket 请求。</p></div></div><p>钉钉服务端收到 WebSocket 握手信息后会通过 ticket 校验客户端身份信息，校验成功后会返回正确的握手信息。</p><div class="theme-admonition theme-admonition-success alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>至此，已经完成了推送订阅通道建立，可以实时接收到订阅的消息列表。下一章节将介绍各种类型的消息，以及如何响应（用于通知钉钉服务端已经成功接收，请勿重复推送）。</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="消息类型">消息类型<a href="#消息类型" class="hash-link" aria-label="Direct link to 消息类型" title="Direct link to 消息类型">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="介绍-1">介绍<a href="#介绍-1" class="hash-link" aria-label="Direct link to 介绍" title="Direct link to 介绍">​</a></h3><p>Stream 模式的通道上，支持多种类型的消息推送，主要类型如下表所示：</p><table><thead><tr><th>一级类型</th><th>二级类型</th><th>Topic</th><th>说明</th></tr></thead><tbody><tr><td>回调推送</td><td>机器人消息回调</td><td>/v1.0/im/bot/messages/get</td><td>通过单聊或群聊给机器人发送消息之后，通过该 Topic 可以接收机器人消息（在群里需要 AT 机器人的消息才能被接收，单聊机器人不用 AT）。</td></tr><tr><td>回调推送</td><td>卡片互动回调</td><td>/v1.0/card/instances/callback</td><td>用户在钉钉的互动卡片中，点击或者其他互动之后，可以通过该 Topic 接收到用户互动操作的回调。</td></tr><tr><td>事件推送</td><td></td><td>*</td><td>事件订阅推送包括钉钉平台各种类型的变更通知，例如员工入职、审批表单状态变化等。<br>由于事件订阅的类型目前在<a href="https://open-dev.dingtalk.com" target="_blank" rel="noopener noreferrer">开发者后台</a>中，可以通过UI界面勾选主题来订阅，因此这里支持通过星号(<!-- -->*<!-- -->)订阅所有勾选的事件。<br>当前不支持通过代码方式指定事件的类型来订阅，请在<a href="https://open.dingtalk.com/document/orgapp/stream#5db30bb0f5iia" target="_blank" rel="noopener noreferrer">开发者后台勾选需要订阅的事件</a>。<br>注意：仅支持星号(<!-- -->*<!-- -->)。</td></tr><tr><td>系统推送</td><td></td><td>ping<br>disconnect</td><td>主要提供 Stream 长连接相关的管理能力，开发者需要正确的处理对应的推送信息保证连接的稳定可靠。SDK 开发者需要关注该事件，使用 SDK 的开发者不用关注。</td></tr></tbody></table><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>为了帮助自定义 SDK 的开发者更快完成接入，以上消息类型中，可以仅实现机器人消息回调或者事件推送其中之一即可，系统推送可以暂不实现。</p><p>如果没有时间开发完善的系统推送处理流程，可以在<a href="/developerpedia/docs/explore/support?via=moon-group">Stream共创群</a>中，联系群主协助。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="通用字段说明">通用字段说明<a href="#通用字段说明" class="hash-link" aria-label="Direct link to 通用字段说明" title="Direct link to 通用字段说明">​</a></h3><p>客户端完成 WebSocket 连接后即可接受来自钉钉平台的推送数据，客户端需要正确处理来自钉钉的推送数据并返回正确格式的响应才能保证运行逻辑的正确性。</p><p>服务端推送的请求数据如下：</p><table><thead><tr><th>名称</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>specVersion</td><td>String</td><td>协议版本号</td><td>1.0</td></tr><tr><td>type</td><td>String</td><td>推送数据类型，当前支持三种：<br>SYSTEM: 系统数据<br>EVENT：事件推送<br>CALLBACK：回调推送</td><td>CALLBACK</td></tr><tr><td>headers</td><td>Object</td><td>协议元数据，内部包含本次推送的消息ID, 推送数据topic, 数据类型,推送时间等信息</td><td>详见解下来的 header 字段描述和示例</td></tr><tr><td>data</td><td>String</td><td>推送数据的 json 字符串</td><td><code>&quot;{\&quot;suiteTicket\&quot; : \&quot;123df-sdfd\&quot;, \&quot;action\&quot;: \&quot;suite\&quot;}&quot;</code></td></tr></tbody></table><p>Headers 中必填的字段如下</p><table><thead><tr><th>名称</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>topic</td><td>String</td><td>本次推送的业务 Topic，详见本文档消息类型章节给出的 Topic 列表</td><td>/v1.0/im/bot/messages/get</td></tr><tr><td>contentType</td><td>String</td><td>标记推送数据的格式，默认为application/json，代表推送的数据为一个json字符串；<br>该字段预留将来支持二进制数据；</td><td>application/json</td></tr><tr><td>messageId</td><td>String</td><td>推送消息ID，标记一次推送，客户端需要关注此信息并且在响应的时候将此信息回传给服务端</td><td>213d841d_972_1898bb26334_70a7</td></tr><tr><td>time</td><td>Number</td><td>推送时间,为unix时间戳，单位：毫秒</td><td>1690106592000</td></tr></tbody></table><p>示例：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;specVersion&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;EVENT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dingTalk&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1693221579964&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user_add_org&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;c7c7120f2c07419***ebdba0318c8&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventCorpId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ding9f50b15b***16741&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventBornTime&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1683533823336&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventUnifiedAppId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bbb381b6-f01xxxxx58daac&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;timestamp\&quot; : \&quot;1685501863357\&quot;, \&quot;userId\&quot; : [\&quot;015xxxx227\&quot;]}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>客户端响应的字段解释如下：</p><table><thead><tr><th>名称</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>code</td><td>Number</td><td>响应码</td><td>200：成功<br>404：topic不存在<br>500：内部错误</td></tr><tr><td>headers</td><td>Object</td><td>响应头</td><td>详见接下来的Header字段说明</td></tr><tr><td>message</td><td>String</td><td>响应消息</td><td>返回响应信息，例如code=200时返回OK，<br>code=500时返回 internal error<br></td></tr><tr><td>data</td><td>String</td><td>返回数据的json字符串</td><td><code>&quot;{\&quot;result\&quot; : &quot;error&quot;}&quot;</code></td></tr></tbody></table><p>推送响应中 headers 必填字段如下：</p><table><thead><tr><th>名称</th><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>messageId</td><td>String</td><td>消息ID, 和推送请求headers中的messageId保持一致</td><td></td></tr><tr><td>contentType</td><td>String</td><td>返回数据的类型，目前只支持application/json</td><td>application/json</td></tr></tbody></table><p>响应示例：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;response\&quot;: {}}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="回调推送">回调推送<a href="#回调推送" class="hash-link" aria-label="Direct link to 回调推送" title="Direct link to 回调推送">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="回调推送一机器人消息">回调推送一：机器人消息<a href="#回调推送一机器人消息" class="hash-link" aria-label="Direct link to 回调推送一：机器人消息" title="Direct link to 回调推送一：机器人消息">​</a></h4><p>机器人回调的服务端推送请求示例如下，data 字段说明详见<a href="https://open.dingtalk.com/document/orgapp/receive-message" target="_blank" rel="noopener noreferrer">文档</a>：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;specVersion&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CALLBACK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;appId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1305d5f5-**-484f-***-97d9****ef67&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;212ca9d7_974_1898c159aa6_1783b&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1690362102194&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/v1.0/im/bot/messages/get&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;conversationId\&quot;:\&quot;cidAsXSBLnA==\&quot;,\&quot;atUsers\&quot;:[{\&quot;dingtalkId\&quot;:\&quot;$:LWCP_v1:$4*****TgHFUDZ8Qi8qr3\&quot;}],\&quot;chatbotCorpId\&quot;:\&quot;ding9f*****cd16741\&quot;,\&quot;chatbotUserId\&quot;:\&quot;$:LWCP_v1:$*****x3vTgHFUDZ8Qi8qr3\&quot;,\&quot;msgId\&quot;:\&quot;msgLICYe****HgY4JtMQw==\&quot;,\&quot;senderNick\&quot;:\&quot;用户\&quot;,\&quot;isAdmin\&quot;:true,\&quot;senderStaffId\&quot;:\&quot;16650***698\&quot;,\&quot;sessionWebhookExpiredTime\&quot;:1690367502152,\&quot;createA\&quot;: 1690362101894,\&quot;senderCorpId\&quot;:\&quot;ding9*****d16741\&quot;,\&quot;conversationType\&quot;:\&quot;2\&quot;,\&quot;senderId\&quot;:\&quot;$:LWCP_v1:***jqTgIfhRX9Q==\&quot;,\&quot;conversationTitle\&quot;:\&quot;测试群\&quot;,\&quot;isInAtList\&quot;:true,\&quot;sessionWebhook\&quot;:\&quot;https://oapi.dingtalk.com/robot/sendBySession?session=76da36b4**********8f59e8\&quot;,\&quot;text\&quot;:{\&quot;content\&quot;:\&quot; 测试数据\&quot;},\&quot;robotCode\&quot;:\&quot;ding*****r3xc0b\&quot;,\&quot;msgtype\&quot;:\&quot;text\&quot;}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>响应示例如下：</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>机器人消息的响应中，只需要标识成功失败即可，钉钉服务端暂时不用该 data 字段，因此 data 字段可以采用固定的内容：<code>{&quot;response&quot;: null}</code></p></div></div><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;response\&quot;: null}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="回调推送二卡片回调">回调推送二：卡片回调<a href="#回调推送二卡片回调" class="hash-link" aria-label="Direct link to 回调推送二：卡片回调" title="Direct link to 回调推送二：卡片回调">​</a></h4><p>待完善，正在加速编写中，敬请期待。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="事件推送">事件推送<a href="#事件推送" class="hash-link" aria-label="Direct link to 事件推送" title="Direct link to 事件推送">​</a></h3><p>钉钉近百种事件推送，包括通讯录、群会话、考勤、审批、日程、签到等，订阅流程以及每一种事件的字段格式说明详见<a href="https://open.dingtalk.com/document/orgapp/stream" target="_blank" rel="noopener noreferrer">官方文档</a>左侧导航目录中可以查看全部事件。</p><p>示例：以企业新增日程为例，推送的格式如下：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;specVersion&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;EVENT&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;header&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1683533823336&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;c7c7120f2c07419**ebdba0318c8&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventBornTime&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1683533823336&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventCorpId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ding9f50b15bxxxx16741&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user_add_org&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;eventUnifiedAppId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bbb381b6-f01xxxxx58daac&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;timeStamp\&quot; : \&quot;1685501863357\&quot;,\&quot;userId\&quot; : [\&quot;015xxxx227\&quot;]}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>响应的 data 中必须包含 status 和 message 字段。字段说明：</p><table><thead><tr><th>名称</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>status</td><td>String</td><td>是</td><td>SUCCESS：标识消费成功<br>LATER：表示消费失败</td></tr><tr><td>message</td><td>String</td><td>否</td><td>自定义的返回字段，辅助诊断</td></tr></tbody></table><p>完整的响应体示例如下：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;status\&quot; : \&quot;SUCCESS\&quot;, \&quot;message\&quot; : \&quot;success\&quot;}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="系统推送">系统推送<a href="#系统推送" class="hash-link" aria-label="Direct link to 系统推送" title="Direct link to 系统推送">​</a></h3><p>系统类型的推送主要提供和 Stream 长连接相关的管理能力，开发者需要正确的处理对应的推送信息保证连接的稳定可靠。</p><p>目前支持两种 topic：</p><ol><li>ping: 用于 WebSocket 长连接健康检查</li><li>disconnect: 用于网络连接优雅断开，避免直接断连接影响业务连续性</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ping-请求处理">ping 请求处理<a href="#ping-请求处理" class="hash-link" aria-label="Direct link to ping 请求处理" title="Direct link to ping 请求处理">​</a></h4><p>ping 请求用于 WebSocket 长连接健康检查，data 中唯一包含的字段是 opaque（全局唯一的 ID 标识），详见示例：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SYSTEM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ping&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;opaque\&quot; : \&quot;123-dsfs\&quot;}&quot;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>收到 ping 请求后不需要做本地处理，直接响应即可。响应数据的 data 中携带请求的 opaque 即可，示例如下：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;messageId&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;213d841d_972_1898bb26334_70a7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;opaque\&quot; : \&quot;123-dsfs\&quot;}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disconnect-请求处理">disconnect 请求处理<a href="#disconnect-请求处理" class="hash-link" aria-label="Direct link to disconnect 请求处理" title="Direct link to disconnect 请求处理">​</a></h4><p>为了保证长连接的健康和服务端的负载均衡，服务端会定时断开长连接，并在断开连接前推送断连信息。</p><p>disconnect 请求中当前仅包含 reason 字段，描述连接断开的原因。
请求示例如下：</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SYSTEM&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;headers&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;topic&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;disconnect&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;contentType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/json&quot;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;data&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;reason\&quot; : \&quot;connection is expired\&quot;}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>响应：客户端不需要对此推送信息做任何响应， 服务端在静默10s之后会主动断开 tcp 连接。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题">常见问题<a href="#常见问题" class="hash-link" aria-label="Direct link to 常见问题" title="Direct link to 常见问题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stream-客户端收到来自钉钉服务端推送的请求之后是否需要回复ack">Stream 客户端收到来自钉钉服务端推送的请求之后，是否需要回复ACK？<a href="#stream-客户端收到来自钉钉服务端推送的请求之后是否需要回复ack" class="hash-link" aria-label="Direct link to Stream 客户端收到来自钉钉服务端推送的请求之后，是否需要回复ACK？" title="Direct link to Stream 客户端收到来自钉钉服务端推送的请求之后，是否需要回复ACK？">​</a></h3><p>补充问题：如果处理时间比较长导致响应回复时间过长，会不会发生中断【非业务消息(ping)除外】</p><p>建议按照本文档中协议描述来回复ACK。ACK主要用途</p><ol><li>&quot;事件订阅&quot;支持相对可靠的推送，因此如果不回复 ACK，会触发服务端的超时重新推送，以及客户端对相同事件的重复处理，造成处理资源的浪费；</li><li>&quot;事件订阅&quot;之外的推送，ACK仅用于问题诊断和分析，建议回复ACK，但是不回复也不影响正常业务处理；</li></ol><p>目前官方SDK会自动处理ACK，例如Python的消息回调中返回 OK 之后(<code>return AckMessage.STATUS_OK, &#x27;OK&#x27;</code>)，会在SDK底层按照协议转成对应格式的ACK发送到钉钉服务端。</p><p>总结：不回复ACK不会造成业务中断，只会造成部分场景（事件订阅）的重复推送，带来资源的浪费。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="如果收到事件推送后正确的回复-ack-响应是否就不会出现重复推送了">如果收到事件推送后，正确的回复 ACK 响应，是否就不会出现重复推送了？<a href="#如果收到事件推送后正确的回复-ack-响应是否就不会出现重复推送了" class="hash-link" aria-label="Direct link to 如果收到事件推送后，正确的回复 ACK 响应，是否就不会出现重复推送了？" title="Direct link to 如果收到事件推送后，正确的回复 ACK 响应，是否就不会出现重复推送了？">​</a></h3><p>依然可能出现重复推送，只是概率会降到很低。原因是网络延迟不可控，如果因为互联网的正常抖动导致推送延迟，触发超时重新推送的话，就会出现重复事件。因此无论是否正确的ACK了，都需要考虑到收到重复事件的可能性。</p><p>备注：机器人消息当前是fire-forgot模式，不会因为网络超时而重复推送。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="响应回复消息中的-code-针对-404-的topic-不存在这个状态目前是预留的吗">响应回复消息中的 code 针对 404 的topic 不存在这个状态目前是预留的吗？<a href="#响应回复消息中的-code-针对-404-的topic-不存在这个状态目前是预留的吗" class="hash-link" aria-label="Direct link to 响应回复消息中的 code 针对 404 的topic 不存在这个状态目前是预留的吗？" title="Direct link to 响应回复消息中的 code 针对 404 的topic 不存在这个状态目前是预留的吗？">​</a></h3><p>补充问题：客户端目前应该无法进行topic 是否存在进行识别</p><p>当前是预留的，从协议完备性上考虑保留了404状态码。钉钉服务端只会推送 Stream Client 注册的 Topic，不会推送未注册的 Topic 下的消息。</p><p>但是考虑到复杂的系统环境下，可能出现的缓存一致性、代码Bug等问题，在协议上预留了 404 状态码表示客户端不支持该 Topic，以用作问题诊断。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="响应消息处理是否支持负载均衡方式处理">响应消息处理是否支持负载均衡方式处理？<a href="#响应消息处理是否支持负载均衡方式处理" class="hash-link" aria-label="Direct link to 响应消息处理是否支持负载均衡方式处理？" title="Direct link to 响应消息处理是否支持负载均衡方式处理？">​</a></h3><p>补充问题：启动多个程序订阅相同事件进行数据处理，担心将来推送数据量大时可能出现无法及时响应的情况；可能需要考虑方案提供给客户端侧进行参考</p><p>支持的。如果事件量较大的话，可以采用多进程，或者单进程下多Stream Client实例方式，建立多个 Stream 通道，也即多个 WebSocket 长连接。钉钉服务端每次推送消息时候，通过随机策略选取一个Stream通道推送。如果需要支持更多的负载均衡策略，可以通过<a href="/developerpedia/docs/explore/support">技术支持</a>提交反馈。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册连接凭证中的-localip-是否可以标记多个ip">注册连接凭证中的 localIp 是否可以标记多个IP？<a href="#注册连接凭证中的-localip-是否可以标记多个ip" class="hash-link" aria-label="Direct link to 注册连接凭证中的 localIp 是否可以标记多个IP？" title="Direct link to 注册连接凭证中的 localIp 是否可以标记多个IP？">​</a></h3><p>补充问题：或增加自定义的客户端标识参数【可选】</p><p>可以支持多个IP，采用英文逗号分隔。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="相关链接">相关链接<a href="#相关链接" class="hash-link" aria-label="Direct link to 相关链接" title="Direct link to 相关链接">​</a></h2><ul><li><a href="/developerpedia/docs/develop/sdk/overview">Stream Mode SDK</a></li><li><a href="https://open.dingtalk.com/document/direction/stream-mode-protocol-access-description" target="_blank" rel="noopener noreferrer">官方文档：Stream Mode 协议文档</a></li><li><a href="https://open.dingtalk.com/document/resourcedownload/introduction-to-stream-mode" target="_blank" rel="noopener noreferrer">官方文档：服务端 Stream 模式介绍</a></li><li><a href="https://open.dingtalk.com/document/orgapp/receive-message" target="_blank" rel="noopener noreferrer">官方文档：接收机器人消息的描述文档</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/open-dingtalk/developerpedia/tree/main/docs/learn/stream/protocol.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/developerpedia/docs/learn/stream/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">概述</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/developerpedia/docs/learn/stream/faq"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">常见问题</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#与-sdk-的关系" class="table-of-contents__link toc-highlight">与 SDK 的关系</a></li><li><a href="#协议接入步骤" class="table-of-contents__link toc-highlight">协议接入步骤</a><ul><li><a href="#介绍" class="table-of-contents__link toc-highlight">介绍</a></li><li><a href="#步骤一注册连接凭证" class="table-of-contents__link toc-highlight">步骤一：注册连接凭证</a></li><li><a href="#步骤二建立-websocket-连接" class="table-of-contents__link toc-highlight">步骤二：建立 WebSocket 连接</a></li></ul></li><li><a href="#消息类型" class="table-of-contents__link toc-highlight">消息类型</a><ul><li><a href="#介绍-1" class="table-of-contents__link toc-highlight">介绍</a></li><li><a href="#通用字段说明" class="table-of-contents__link toc-highlight">通用字段说明</a></li><li><a href="#回调推送" class="table-of-contents__link toc-highlight">回调推送</a></li><li><a href="#事件推送" class="table-of-contents__link toc-highlight">事件推送</a></li><li><a href="#系统推送" class="table-of-contents__link toc-highlight">系统推送</a></li></ul></li><li><a href="#常见问题" class="table-of-contents__link toc-highlight">常见问题</a><ul><li><a href="#stream-客户端收到来自钉钉服务端推送的请求之后是否需要回复ack" class="table-of-contents__link toc-highlight">Stream 客户端收到来自钉钉服务端推送的请求之后，是否需要回复ACK？</a></li><li><a href="#如果收到事件推送后正确的回复-ack-响应是否就不会出现重复推送了" class="table-of-contents__link toc-highlight">如果收到事件推送后，正确的回复 ACK 响应，是否就不会出现重复推送了？</a></li><li><a href="#响应回复消息中的-code-针对-404-的topic-不存在这个状态目前是预留的吗" class="table-of-contents__link toc-highlight">响应回复消息中的 code 针对 404 的topic 不存在这个状态目前是预留的吗？</a></li><li><a href="#响应消息处理是否支持负载均衡方式处理" class="table-of-contents__link toc-highlight">响应消息处理是否支持负载均衡方式处理？</a></li><li><a href="#注册连接凭证中的-localip-是否可以标记多个ip" class="table-of-contents__link toc-highlight">注册连接凭证中的 localIp 是否可以标记多个IP？</a></li></ul></li><li><a href="#相关链接" class="table-of-contents__link toc-highlight">相关链接</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/developerpedia/docs/explore/tutorials/stream/overview">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/open-dingtalk" target="_blank" rel="noopener noreferrer" class="footer__link-item">钉钉开源项目<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/weir-cloud/awesome-dingtalk" target="_blank" rel="noopener noreferrer" class="footer__link-item">Awesome DingTalk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://open.dingtalk.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">钉钉开放平台<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 DingTalk</div></div></div></footer></div>
<script src="/developerpedia/assets/js/runtime~main.efb555ec.js"></script>
<script src="/developerpedia/assets/js/main.9f82b880.js"></script>
</body>
</html>